<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Ops Dashboard</title>

  <!-- Chart.js (solo line + scatter) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f6f8;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --shadow: 0 1px 2px rgba(0,0,0,.06), 0 6px 18px rgba(0,0,0,.06);
      --radius:14px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial;
      background:var(--bg);
      color:var(--text);
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:#ffffffcc;
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }

    .topbar{
      max-width:1320px;
      margin:0 auto;
      padding:14px 18px;
    }

    h1{
      margin:0;
      font-size:16px;
      font-weight:700;
    }

    .subhead{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .wrap{
      padding:18px;
      max-width:1320px;
      margin:0 auto;
    }

    .grid{ display:grid; gap:12px; }
    .filters{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    .kpis{ grid-template-columns: repeat(5, minmax(0,1fr)); }
    .row2{ grid-template-columns: 1.6fr 1fr; }
    .row3{ grid-template-columns: 1.2fr 1.8fr; }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:12px;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }

    select,input{
      width:100%;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
    }

    .kpi .name{
      font-size:12px;
      color:var(--muted);
      font-weight:500;
    }

    .kpi .val{
      font-size:22px;
      font-weight:700;
      margin-top:6px;
    }

    .kpi .sub{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    .title{
      font-size:13px;
      font-weight:700;
      margin-bottom:8px;
    }

    canvas{
      width:100% !important;
      height:320px !important;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }

    th,td{
      padding:10px 8px;
      border-bottom:1px solid var(--line);
    }

    th{
      text-align:left;
      color:var(--muted);
      font-weight:700;
      font-size:12px;
      text-transform:uppercase;
    }

    tr:hover td{ background:#fafafa; }

    .muted{
      color:var(--muted);
      font-size:12px;
    }

    /* Funnel */
    .funnel{ display:grid; gap:10px; }
    .frow{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      display:flex;
      justify-content:space-between;
      background:#fff;
    }

    .fname{ font-weight:700; font-size:13px; }
    .fmeta{ font-size:12px; color:var(--muted); }

    @media (max-width:1100px){
      .filters{ grid-template-columns: repeat(2,1fr); }
      .kpis{ grid-template-columns: repeat(2,1fr); }
      .row2,.row3{ grid-template-columns: 1fr; }
      canvas{ height:260px !important; }
    }
  </style>
</head>

<body>

<header>
  <div class="topbar">
    <h1>Sales Ops Dashboard</h1>
    <div class="subhead">Reporte operativo – estilo Looker Studio</div>
  </div>
</header>

<div class="wrap">

  <!-- FILTROS -->
  <div class="grid filters">
    <div class="card">
      <label>Fecha desde</label>
      <input type="date" id="dateStart">
    </div>
    <div class="card">
      <label>Fecha hasta</label>
      <input type="date" id="dateEnd">
    </div>
    <div class="card">
      <label>Team</label>
      <select id="teamSel"></select>
    </div>
    <div class="card">
      <label>Agente</label>
      <select id="agentSel"></select>
    </div>
  </div>

  <!-- KPIs -->
  <div style="height:12px"></div>
  <div class="grid kpis" id="kpiGrid"></div>

  <!-- Tendencia + Funnel -->
  <div style="height:12px"></div>
  <div class="grid row2">
    <div class="card">
      <div class="title">Rendimiento diario</div>
      <canvas id="trendChart"></canvas>
    </div>

    <div class="card">
      <div class="title">Embudo</div>
      <div class="funnel" id="funnelBox"></div>
    </div>
  </div>

  <!-- Ranking + Scatter -->
  <div style="height:12px"></div>
  <div class="grid row3">
    <div class="card">
      <div class="title">Ranking por agente (Facturado)</div>
      <div style="overflow:auto; max-height:420px;">
        <table id="rankTable">
          <thead>
            <tr>
              <th>Agente</th>
              <th>Team</th>
              <th>Dials</th>
              <th>Contacts</th>
              <th>Success</th>
              <th>Facturado</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="title">Contacts vs Facturado</div>
      <canvas id="scatterChart"></canvas>
    </div>
  </div>

  <div class="muted" style="margin-top:14px;">
    Fuente de datos: CSV (GitHub Pages)
  </div>
</div>

<script>
/* ==========================
   UTILIDADES
========================== */
const money = v => isNaN(v) ? "—" : `$${v.toLocaleString()}`;
const intf = v => isNaN(v) ? "—" : v.toLocaleString();

const sum = arr => arr.reduce((a,b)=>a+(+b||0),0);

function parseCSV(txt){
  const l = txt.trim().split(/\r?\n/);
  const h = l[0].split(",");
  return l.slice(1).map(r=>{
    const o={};
    r.split(",").forEach((v,i)=>o[h[i]]=v);
    return o;
  });
}

function toISO(d){
  if(d.includes("-")) return d;
  const [dd,mm,yy]=d.split("/");
  return `${yy}-${mm}-${dd}`;
}

/* ==========================
   CARGA DE DATOS
========================== */
let agents=[], daily=[];

async function load(){
  daily = parseCSV(await fetch("data/daily_summary.csv").then(r=>r.text()))
    .map(r=>({...r, Fecha:toISO(r.Fecha), Facturado:+r.Facturado||0}));

  agents = parseCSV(await fetch("data/agents_detail.csv").then(r=>r.text()))
    .map(r=>({...r, Fecha:toISO(r.Fecha), Facturado:+r.Facturado||0}));

  initFilters();
  render();
}

/* ==========================
   FILTROS
========================== */
const ds=document.getElementById("dateStart");
const de=document.getElementById("dateEnd");
const ts=document.getElementById("teamSel");
const as=document.getElementById("agentSel");

function initFilters(){
  const dates=[...new Set(agents.map(a=>a.Fecha))].sort();
  ds.value=dates[0];
  de.value=dates[dates.length-1];

  ts.innerHTML=`<option value="all">Todos</option>`+
    [...new Set(agents.map(a=>a.Team))].map(t=>`<option>${t}</option>`).join("");

  fillAgents();
  [ds,de,ts,as].forEach(e=>e.onchange=render);
  ts.onchange=()=>{fillAgents();render();}
}

function fillAgents(){
  const t=ts.value;
  const list=agents.filter(a=>t==="all"||a.Team===t);
  as.innerHTML=`<option value="all">Todos</option>`+
    [...new Set(list.map(a=>a.Agente))].map(a=>`<option>${a}</option>`).join("");
}

function filtered(){
  return agents.filter(a=>
    a.Fecha>=ds.value && a.Fecha<=de.value &&
    (ts.value==="all"||a.Team===ts.value) &&
    (as.value==="all"||a.Agente===as.value)
  );
}

/* ==========================
   RENDER
========================== */
let trendChart, scatterChart;

function render(){
  const rows=filtered();

  // KPIs
  const kpis=[
    ["Dials",sum(rows.map(r=>+r.Dials))],
    ["Contacts",sum(rows.map(r=>+r.Contacts))],
    ["Success",sum(rows.map(r=>+r["Success Hubspot"]))],
    ["Facturado",money(sum(rows.map(r=>r.Facturado)))],
  ];

  document.getElementById("kpiGrid").innerHTML=
    kpis.map(k=>`
      <div class="card kpi">
        <div class="name">${k[0]}</div>
        <div class="val">${k[1]}</div>
      </div>`).join("");

  // Trend (line)
  if(trendChart) trendChart.destroy();
  const byDate={};
  rows.forEach(r=>{
    byDate[r.Fecha]=(byDate[r.Fecha]||0)+r.Facturado;
  });

  trendChart=new Chart(trendChart=document.getElementById("trendChart"),{
    type:"line",
    data:{
      labels:Object.keys(byDate),
      datasets:[{
        label:"Facturado",
        data:Object.values(byDate),
        borderWidth:2,
        tension:.3
      }]
    }
  });

  // Funnel
  const funnel=[
    ["Inbound",sum(rows.map(r=>+r["Lead Inbound"]))],
    ["Presentación",sum(rows.map(r=>+r["Product Presentation"]))],
    ["Cotización",sum(rows.map(r=>+r.Cotizacion))],
    ["Success",sum(rows.map(r=>+r["Success Hubspot"]))],
    ["Facturado",money(sum(rows.map(r=>r.Facturado)))]
  ];

  document.getElementById("funnelBox").innerHTML=
    funnel.map(f=>`
      <div class="frow">
        <div>
          <div class="fname">${f[0]}</div>
          <div class="fmeta">—</div>
        </div>
        <div><strong>${f[1]}</strong></div>
      </div>`).join("");

  // Ranking
  const map={};
  rows.forEach(r=>{
    map[r.Agente]=(map[r.Agente]||0)+r.Facturado;
  });

  document.querySelector("#rankTable tbody").innerHTML=
    Object.entries(map).sort((a,b)=>b[1]-a[1]).map(r=>`
      <tr>
        <td>${r[0]}</td>
        <td>${money(r[1])}</td>
        <td colspan="4"></td>
      </tr>`).join("");

  // Scatter
  if(scatterChart) scatterChart.destroy();
  scatterChart=new Chart(scatterChart=document.getElementById("scatterChart"),{
    type:"scatter",
    data:{
      datasets:[{
        data:rows.map(r=>({x:+r.Contacts,y:r.Facturado}))
      }]
    }
  });
}

load();
</script>

</body>
</html>


           

       
