<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <h1>Dashboard Efectividad de Ventas</h1> | 19-20 Ene 2026</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a2e;
      --panel2:#0c1628;
      --text:#e7eefc;
      --muted:#9fb2d6;
      --line:rgba(255,255,255,.08);
      --accent:#2f7bff;
      --good:#29d07f;
      --bad:#ff4d6d;
      --warn:#ffcc00;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -20%, rgba(47,123,255,.25), transparent 60%),
        radial-gradient(1000px 500px at 100% 0%, rgba(41,208,127,.18), transparent 50%),
        linear-gradient(180deg, #070c16, var(--bg));
    }
    .wrap{max-width:1280px; margin:0 auto; padding:22px;}
    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:16px;
      margin-bottom:18px;
    }
    .title h1{margin:0; font-size:22px; letter-spacing:.2px;}
    .title p{margin:6px 0 0; color:var(--muted); font-size:13px;}
    .filters{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      min-width:min(720px, 100%);
    }
    .filter{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      box-shadow: var(--shadow);
    }
    .filter label{display:block; font-size:11px; color:var(--muted); margin-bottom:6px;}
    select, input{
      width:100%;
      background:transparent;
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      border-radius:12px;
      padding:9px 10px;
      outline:none;
      font-size:13px;
    }
    option{background:#0b1220;}
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px 0;
    }
    .card .hd h3{margin:0; font-size:13px; color:var(--muted); font-weight:600;}
    .card .bd{padding:12px 16px 16px;}
    .kpis{grid-column: 1 / -1; padding:14px;}
    .kpiRow{
      display:grid; grid-template-columns: repeat(6, minmax(0,1fr));
      gap:12px;
    }
    .kpi{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px 12px;
      min-height:84px;
    }
    .kpi .name{font-size:11px; color:var(--muted); margin-bottom:8px;}
    .kpi .val{font-size:20px; font-weight:800; letter-spacing:.2px;}
    .kpi .sub{
      margin-top:6px;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      font-size:12px; color:var(--muted);
    }
    .chip{
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      font-family:var(--mono);
      font-size:11px;
    }
    .delta.good{color:var(--good)}
    .delta.bad{color:var(--bad)}
    .delta.neutral{color:var(--muted)}
    .chart1{grid-column: 1 / 8;}
    .chart2{grid-column: 8 / -1;}
    .tableCard{grid-column: 1 / -1;}
    canvas{width:100% !important; height:320px !important;}
    .tableWrap{overflow:auto; border-radius:16px; border:1px solid var(--line); background:rgba(0,0,0,.18);}
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      min-width:1050px;
    }
    thead th{
      position:sticky; top:0;
      background:rgba(11,18,32,.92);
      backdrop-filter: blur(10px);
      z-index:2;
      text-align:left;
      padding:10px 10px;
      font-size:11px;
      color:var(--muted);
      border-bottom:1px solid var(--line);
      white-space:nowrap;
    }
    tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:12px;
      white-space:nowrap;
    }
    tbody tr:hover td{background:rgba(255,255,255,.03);}
    .pill{
      font-family:var(--mono);
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      display:inline-flex; align-items:center; gap:6px;
    }
    .pill.good{border-color:rgba(41,208,127,.35); background:rgba(41,208,127,.08);}
    .pill.bad{border-color:rgba(255,77,109,.35); background:rgba(255,77,109,.08);}
    .pill.neutral{border-color:rgba(255,255,255,.12);}
    .mono{font-family:var(--mono)}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .foot{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .btn{
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:var(--text);
      font-size:12px;
    }
    .btn:hover{background:rgba(255,255,255,.08);}
    @media (max-width: 1100px){
      .filters{grid-template-columns:1fr; min-width:unset;}
      .kpiRow{grid-template-columns: repeat(2, minmax(0,1fr));}
      .chart1{grid-column: 1 / -1;}
      .chart2{grid-column: 1 / -1;}
      canvas{height:300px !important;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Dashboard Diario </h1>
        <p>Comparativo por equipo y agente • <span class="mono">2026-01-19</span> vs <span class="mono">2026-01-20</span></p>
      </div>

      <div class="filters">
        <div class="filter">
          <label for="dateSel">Fecha (detalle y ranking)</label>
          <select id="dateSel">
            <option value="2026-01-19">19/01/2026</option>
            <option value="2026-01-20">20/01/2026</option>
          </select>
        </div>

        <div class="filter">
          <label for="teamSel">Team</label>
          <select id="teamSel">
            <option value="__ALL__">Todos</option>
          </select>
        </div>

        <div class="filter">
          <label for="metricSel">Métrica principal (tarjetas y ranking)</label>
          <select id="metricSel">
            <option value="dials">Dials</option>
            <option value="contacts">Contacts</option>
            <option value="successFive9">Success Five9</option>
            <option value="talkTimeSec">Talk Time</option>
            <option value="leadInbound">Lead Inbound</option>
            <option value="productPresentation">Product Presentation</option>
            <option value="cotizacion">Cotización</option>
            <option value="successHubspot">Success HubSpot</option>
            <option value="totalClientes">Total de Clientes</option>
            <option value="campanas">Campañas</option>
            <option value="facturado">Facturado</option>
          </select>
        </div>
      </div>
    </header>

    <div class="grid">

      <!-- KPI CARD -->
      <div class="card kpis">
        <div class="hd">
          <h3>Resumen diario (con delta vs el otro día)</h3>
          <div style="display:flex; gap:10px; align-items:center;">
            <span class="chip" id="scopeChip">Scope: Todos</span>
            <button class="btn" id="resetBtn">Reset filtros</button>
          </div>
        </div>
        <div class="bd">
          <div class="kpiRow" id="kpiRow"></div>
        </div>
      </div>

      <!-- CHART 1 -->
      <div class="card chart1">
        <div class="hd"><h3>Comparativo Totales por Día</h3></div>
        <div class="bd">
          <canvas id="totalsChart"></canvas>
        </div>
      </div>

      <!-- CHART 2 -->
      <div class="card chart2">
        <div class="hd"><h3>Ranking por Agente (según métrica seleccionada)</h3></div>
        <div class="bd">
          <canvas id="rankChart"></canvas>
        </div>
      </div>

      <!-- TABLE -->
      <div class="card tableCard">
        <div class="hd">
          <h3>Detalle por Agente (Fecha seleccionada)</h3>
          <span class="muted" id="tableHint">Tip: usa “Team” para filtrar.</span>
        </div>
        <div class="bd">
          <div class="tableWrap">
            <table id="detailTable">
              <thead>
                <tr>
                  <th>Team</th>
                  <th>Agente</th>
                  <th class="right">Dials</th>
                  <th class="right">Contacts</th>
                  <th class="right">Success Five9</th>
                  <th class="right">Talk Time</th>
                  <th class="right">Lead Inbound</th>
                  <th class="right">Product Presentation</th>
                  <th class="right">Cotización</th>
                  <th class="right">Success HubSpot</th>
                  <th class="right">Cliente Outbound</th>
                  <th class="right">Referido</th>
                  <th class="right">Inbound Meses Anteriores</th>
                  <th class="right">Nuevos Lead MM</th>
                  <th class="right">Total Clientes</th>
                  <th class="right">Campañas</th>
                  <th class="right">Facturado</th>
                </tr>
              </thead>
              <tbody id="detailTbody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

    <div class="foot">
      <div>
        <span class="pill neutral">Notas</span>
        <span class="muted">El dashboard es estático (ideal para GitHub Pages). Talk Time se procesa como tiempo (HH:MM:SS).</span>
      </div>
      <div class="muted mono" id="lastUpdated"></div>
    </div>
  </div>

  <script>
    // -----------------------------
    // 1) DATA (embebida)
    // -----------------------------
    const DAILY_TOTALS = {
      "2026-01-19": {
        dials: 2044,
        contacts: 529,
        talkTime: "29:28:29",
        successFive9: 8,
        leadInbound: 0,
        productPresentation: 9,
        cotizacion: 1,
        successHubspot: 10,
        clienteOutbound: 0,
        referido: 0,
        inboundMesesAnteriores: 1,
        nuevosLeadMM: 1,
        totalClientes: 2,
        campanas: 0,
        facturado: 2500.00
      },
      "2026-01-20": {
        dials: 1770,
        contacts: 617,
        talkTime: "39:54:24",
        successFive9: 17,
        leadInbound: 67,
        productPresentation: 12,
        cotizacion: 2,
        successHubspot: 14,
        clienteOutbound: 1,
        referido: 0,
        inboundMesesAnteriores: 0,
        nuevosLeadMM: 0,
        totalClientes: 1,
        campanas: 2,
        facturado: 3700.00
      }
    };

    // Detalle por agente (por día)
    // Nota: campos vacíos/espacios => 0
    const AGENT_ROWS = [
      // 19/01
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Angeles Espinoza", dials:205, contacts:16, successFive9:0, talkTime:"0:58:27", leadInbound:0, productPresentation:1, cotizacion:0, successHubspot:1, clienteOutbound:0, referido:0, inboundMesesAnteriores:1, nuevosLeadMM:0, totalClientes:1, campanas:0, facturado:500.00},
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Geraldine Murillo", dials:297, contacts:16, successFive9:0, talkTime:"1:36:11", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Judith Mercado", dials:126, contacts:13, successFive9:2, talkTime:"1:42:06", leadInbound:0, productPresentation:2, cotizacion:0, successHubspot:2, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Rodrigo Guadamuz", dials:159, contacts:11, successFive9:0, talkTime:"1:30:59", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Alexia Rodríguez", dials:156, contacts:18, successFive9:0, talkTime:"2:01:05", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Equipo de Ventas Anuar", agent:"Mariett Castro", dials:181, contacts:14, successFive9:0, talkTime:"3:08:35", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},

      {date:"2026-01-19", team:"Post venta", agent:"Andrea Rivera", dials:197, contacts:172, successFive9:0, talkTime:"3:25:38", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:500.00},
      {date:"2026-01-19", team:"Post venta", agent:"Alejandra Rodriguez", dials:65, contacts:20, successFive9:0, talkTime:"1:18:55", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Ariana Leiva", dials:157, contacts:73, successFive9:1, talkTime:"2:00:25", leadInbound:0, productPresentation:1, cotizacion:0, successHubspot:1, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:500.00},
      {date:"2026-01-19", team:"Post venta", agent:"David Espinoza", dials:75, contacts:55, successFive9:0, talkTime:"2:40:03", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Jonathan Salinas", dials:83, contacts:23, successFive9:3, talkTime:"3:47:33", leadInbound:0, productPresentation:3, cotizacion:0, successHubspot:3, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Mario Castano", dials:33, contacts:25, successFive9:0, talkTime:"1:40:47", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Nicole Garcia", dials:164, contacts:46, successFive9:2, talkTime:"1:50:24", leadInbound:0, productPresentation:2, cotizacion:1, successHubspot:3, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Paola Paz", dials:0, contacts:0, successFive9:0, talkTime:"0:00:00", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-19", team:"Post venta", agent:"Veronica Ramirez", dials:146, contacts:27, successFive9:0, talkTime:"1:47:21", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:1, nuevosLeadMM:1, totalClientes:0, campanas:0, facturado:1000.00},

      // 20/01
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Angeles Espinoza", dials:243, contacts:32, successFive9:4, talkTime:"4:03:04", leadInbound:3, productPresentation:4, cotizacion:0, successHubspot:4, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Geraldine Murillo", dials:294, contacts:31, successFive9:0, talkTime:"2:35:57", leadInbound:11, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Judith Mercado", dials:179, contacts:24, successFive9:2, talkTime:"2:31:13", leadInbound:10, productPresentation:2, cotizacion:0, successHubspot:2, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Rodrigo Guadamuz", dials:0, contacts:0, successFive9:0, talkTime:"0:00:00", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Alexia Rodríguez", dials:132, contacts:22, successFive9:1, talkTime:"2:59:19", leadInbound:8, productPresentation:1, cotizacion:0, successHubspot:1, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:500.00},
      {date:"2026-01-20", team:"Equipo de Ventas Anuar", agent:"Mariett Castro", dials:97, contacts:20, successFive9:4, talkTime:"3:54:16", leadInbound:7, productPresentation:2, cotizacion:0, successHubspot:2, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:1100.00},

      {date:"2026-01-20", team:"Post venta", agent:"Andrea Rivera", dials:103, contacts:87, successFive9:0, talkTime:"4:05:41", leadInbound:6, productPresentation:1, cotizacion:0, successHubspot:1, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:1, facturado:450.00},
      {date:"2026-01-20", team:"Post venta", agent:"Alejandra Rodriguez", dials:98, contacts:61, successFive9:0, talkTime:"3:00:45", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Post venta", agent:"Ariana Leiva", dials:109, contacts:58, successFive9:1, talkTime:"2:35:48", leadInbound:5, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:750.00},
      {date:"2026-01-20", team:"Post venta", agent:"David Espinoza", dials:109, contacts:85, successFive9:0, talkTime:"1:35:00", leadInbound:5, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Post venta", agent:"Jonathan Salinas", dials:87, contacts:31, successFive9:0, talkTime:"2:56:26", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:300.00},
      {date:"2026-01-20", team:"Post venta", agent:"Mario Castano", dials:73, contacts:61, successFive9:0, talkTime:"2:31:20", leadInbound:1, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:1, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:1, campanas:1, facturado:300.00},
      {date:"2026-01-20", team:"Post venta", agent:"Nicole Garcia", dials:130, contacts:69, successFive9:4, talkTime:"3:12:46", leadInbound:5, productPresentation:1, cotizacion:2, successHubspot:3, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Post venta", agent:"Paola Paz", dials:0, contacts:0, successFive9:0, talkTime:"0:00:00", leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:0.00},
      {date:"2026-01-20", team:"Post venta", agent:"Veronica Ramirez", dials:116, contacts:36, successFive9:1, talkTime:"3:52:49", leadInbound:6, productPresentation:1, cotizacion:0, successHubspot:1, clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0, totalClientes:0, campanas:0, facturado:300.00}
    ];

    // -----------------------------
    // 2) HELPERS
    // -----------------------------
    const fmtInt = (n) => new Intl.NumberFormat("es-ES").format(n ?? 0);
    const fmtMoney = (n) => new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(n ?? 0);
    const clamp = (x,min,max)=>Math.max(min,Math.min(max,x));

    function timeToSeconds(hms){
      const parts = String(hms || "0:00:00").split(":").map(x=>parseInt(x,10)||0);
      while(parts.length<3) parts.unshift(0);
      const [h,m,s]=parts;
      return h*3600 + m*60 + s;
    }
    function secondsToHMS(sec){
      sec = Math.max(0, Math.floor(sec||0));
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return `${h}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    }

    function deltaClass(d){
      if (d > 0) return "good";
      if (d < 0) return "bad";
      return "neutral";
    }
    function deltaText(d, isMoney=false, isTime=false){
      if (isTime){
        const sign = d>0?"+":d<0?"-":"";
        return sign + secondsToHMS(Math.abs(d));
      }
      if (isMoney){
        const sign = d>0?"+":"";
        return sign + fmtMoney(d).replace("$-","-$");
      }
      const sign = d>0?"+":"";
      return sign + fmtInt(d);
    }

    function pickLabel(metric){
      const map = {
        dials: "Dials",
        contacts: "Contacts",
        successFive9: "Success Five9",
        talkTimeSec: "Talk Time",
        leadInbound: "Lead Inbound",
        productPresentation: "Product Presentation",
        cotizacion: "Cotización",
        successHubspot: "Success HubSpot",
        clienteOutbound: "Cliente Outbound",
        referido: "Referido",
        inboundMesesAnteriores: "Inbound Meses Anteriores",
        nuevosLeadMM: "Nuevos Lead MM",
        totalClientes: "Total Clientes",
        campanas: "Campañas",
        facturado: "Facturado"
      };
      return map[metric] || metric;
    }

    function getOtherDate(d){
      return d === "2026-01-19" ? "2026-01-20" : "2026-01-19";
    }

    // -----------------------------
    // 3) UI STATE
    // -----------------------------
    const state = {
      date: "2026-01-19",
      team: "__ALL__",
      metric: "facturado"
    };

    const dateSel = document.getElementById("dateSel");
    const teamSel = document.getElementById("teamSel");
    const metricSel = document.getElementById("metricSel");
    const scopeChip = document.getElementById("scopeChip");
    const kpiRow = document.getElementById("kpiRow");
    const detailTbody = document.getElementById("detailTbody");
    const resetBtn = document.getElementById("resetBtn");
    const lastUpdated = document.getElementById("lastUpdated");

    // -----------------------------
    // 4) INIT FILTERS
    // -----------------------------
    function initTeams(){
      const teams = Array.from(new Set(AGENT_ROWS.map(r=>r.team))).sort();
      for(const t of teams){
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        teamSel.appendChild(opt);
      }
    }

    // -----------------------------
    // 5) DATA VIEWS
    // -----------------------------
    function filteredRows(date, team){
      return AGENT_ROWS
        .filter(r => r.date === date)
        .filter(r => team === "__ALL__" ? true : r.team === team);
    }

    function summarizeRows(rows){
      // Suma por campos numéricos; talk time a segundos
      const sum = {
        dials:0, contacts:0, successFive9:0, talkTimeSec:0,
        leadInbound:0, productPresentation:0, cotizacion:0, successHubspot:0,
        clienteOutbound:0, referido:0, inboundMesesAnteriores:0, nuevosLeadMM:0,
        totalClientes:0, campanas:0, facturado:0
      };
      for(const r of rows){
        sum.dials += r.dials||0;
        sum.contacts += r.contacts||0;
        sum.successFive9 += r.successFive9||0;
        sum.talkTimeSec += timeToSeconds(r.talkTime);
        sum.leadInbound += r.leadInbound||0;
        sum.productPresentation += r.productPresentation||0;
        sum.cotizacion += r.cotizacion||0;
        sum.successHubspot += r.successHubspot||0;
        sum.clienteOutbound += r.clienteOutbound||0;
        sum.referido += r.referido||0;
        sum.inboundMesesAnteriores += r.inboundMesesAnteriores||0;
        sum.nuevosLeadMM += r.nuevosLeadMM||0;
        sum.totalClientes += r.totalClientes||0;
        sum.campanas += r.campanas||0;
        sum.facturado += r.facturado||0;
      }
      return sum;
    }

    function totalsFromSource(date, team){
      // Si no hay team filter, usa DAILY_TOTALS (más fiel al “Total” que pegaste)
      // Si hay team filter, recalcula desde AGENT_ROWS (porque el total por team no viene aparte)
      if (team === "__ALL__"){
        const t = DAILY_TOTALS[date];
        return {
          dials: t.dials,
          contacts: t.contacts,
          successFive9: t.successFive9,
          talkTimeSec: timeToSeconds(t.talkTime),
          leadInbound: t.leadInbound,
          productPresentation: t.productPresentation,
          cotizacion: t.cotizacion,
          successHubspot: t.successHubspot,
          clienteOutbound: t.clienteOutbound,
          referido: t.referido,
          inboundMesesAnteriores: t.inboundMesesAnteriores,
          nuevosLeadMM: t.nuevosLeadMM,
          totalClientes: t.totalClientes,
          campanas: t.campanas,
          facturado: t.facturado
        };
      }
      return summarizeRows(filteredRows(date, team));
    }

    // -----------------------------
    // 6) RENDER KPIs
    // -----------------------------
    function renderKPIs(){
      const d = state.date;
      const other = getOtherDate(d);

      const cur = totalsFromSource(d, state.team);
      const oth = totalsFromSource(other, state.team);

      scopeChip.textContent = `Scope: ${state.team === "__ALL__" ? "Todos" : state.team}`;

      const kpis = [
        {key:"dials", label:"Total Dials", fmt:(x)=>fmtInt(x), delta:(a,b)=>a-b},
        {key:"contacts", label:"Total Contacts", fmt:(x)=>fmtInt(x), delta:(a,b)=>a-b},
        {key:"successFive9", label:"Éxitos Five9", fmt:(x)=>fmtInt(x), delta:(a,b)=>a-b},
        {key:"successHubspot", label:"Éxitos HubSpot", fmt:(x)=>fmtInt(x), delta:(a,b)=>a-b},
        {key:"leadInbound", label:"Lead Inbound", fmt:(x)=>fmtInt(x), delta:(a,b)=>a-b},
        {key:"facturado", label:"Facturado", fmt:(x)=>fmtMoney(x), delta:(a,b)=>a-b, isMoney:true}
      ];

      // Swap one KPI based on metricSel (para que el usuario sienta control)
      const main = state.metric;
      if (!kpis.some(k => k.key === main)){
        // replace Lead Inbound card with chosen metric (if not already present)
        kpis[4] = {
          key: main,
          label: pickLabel(main),
          fmt: (x)=>{
            if (main === "talkTimeSec") return secondsToHMS(x);
            if (main === "facturado") return fmtMoney(x);
            return fmtInt(x);
          },
          delta: (a,b)=>a-b,
          isMoney: main === "facturado",
          isTime: main === "talkTimeSec"
        };
      }

      kpiRow.innerHTML = "";
      for(const k of kpis){
        const a = cur[k.key] ?? 0;
        const b = oth[k.key] ?? 0;
        const dlt = (k.delta ? k.delta(a,b) : (a-b));
        const cls = deltaClass(dlt);

        const div = document.createElement("div");
        div.className = "kpi";
        div.innerHTML = `
          <div class="name">${k.label}</div>
          <div class="val">${k.fmt ? k.fmt(a) : fmtInt(a)}</div>
          <div class="sub">
            <span class="chip mono">vs ${other.replaceAll("-","/")}</span>
            <span class="delta ${cls} mono">${deltaText(dlt, !!k.isMoney, !!k.isTime)}</span>
          </div>
        `;
        kpiRow.appendChild(div);
      }
    }

    // -----------------------------
    // 7) CHARTS
    // -----------------------------
    let totalsChart, rankChart;

    function buildTotalsChart(){
      const labels = ["19/01/2026", "20/01/2026"];
      const d1 = totalsFromSource("2026-01-19", state.team);
      const d2 = totalsFromSource("2026-01-20", state.team);

      const metrics = [
        {key:"dials", label:"Dials"},
        {key:"contacts", label:"Contacts"},
        {key:"successFive9", label:"Success Five9"},
        {key:"successHubspot", label:"Success HubSpot"},
        {key:"leadInbound", label:"Lead Inbound"},
        {key:"facturado", label:"Facturado (USD)", money:true}
      ];

      const ds = metrics.map(m => ({
        label: m.label,
        data: [d1[m.key] ?? 0, d2[m.key] ?? 0]
      }));

      const ctx = document.getElementById("totalsChart");
      if (totalsChart) totalsChart.destroy();
      totalsChart = new Chart(ctx, {
        type: "bar",
        data: { labels, datasets: ds },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins:{
            legend:{ position:"bottom", labels:{ color:"#e7eefc" } },
            tooltip:{
              callbacks:{
                label: (ctx)=>{
                  const label = ctx.dataset.label || "";
                  const val = ctx.parsed.y ?? 0;
                  const isMoney = label.includes("USD");
                  return `${label}: ${isMoney ? fmtMoney(val) : fmtInt(val)}`;
                }
              }
            }
          },
          scales:{
            x:{ ticks:{ color:"#9fb2d6" }, grid:{ color:"rgba(255,255,255,.06)" } },
            y:{ ticks:{ color:"#9fb2d6" }, grid:{ color:"rgba(255,255,255,.06)" } }
          }
        }
      });
    }

    function buildRankChart(){
      const rows = filteredRows(state.date, state.team);

      const metric = state.metric;
      const label = pickLabel(metric);

      // compute metric value per row
      const values = rows.map(r => {
        let v = r[metric] ?? 0;
        if (metric === "talkTimeSec") v = timeToSeconds(r.talkTime);
        return { agent: r.agent, team: r.team, v };
      });

      // sort desc, take top 10 (but show all if fewer)
      values.sort((a,b)=>b.v - a.v);
      const top = values.slice(0, 10);

      const labels = top.map(x => x.agent);
      const data = top.map(x => x.v);

      const ctx = document.getElementById("rankChart");
      if (rankChart) rankChart.destroy();
      rankChart = new Chart(ctx, {
        type:"bar",
        data:{
          labels,
          datasets:[{
            label: `${label} (${state.date === "2026-01-19" ? "19/01" : "20/01"})`,
            data
          }]
        },
        options:{
          indexAxis:"y",
          responsive:true,
          maintainAspectRatio:false,
          plugins:{
            legend:{ position:"bottom", labels:{ color:"#e7eefc" } },
            tooltip:{
              callbacks:{
                label:(ctx)=>{
                  const v = ctx.parsed.x ?? 0;
                  if (metric === "facturado") return `${label}: ${fmtMoney(v)}`;
                  if (metric === "talkTimeSec") return `${label}: ${secondsToHMS(v)}`;
                  return `${label}: ${fmtInt(v)}`;
                }
              }
            }
          },
          scales:{
            x:{ ticks:{ color:"#9fb2d6" }, grid:{ color:"rgba(255,255,255,.06)" } },
            y:{ ticks:{ color:"#9fb2d6" }, grid:{ color:"rgba(255,255,255,.06)" } }
          }
        }
      });
    }

    // -----------------------------
    // 8) TABLE
    // -----------------------------
    function renderTable(){
      const rows = filteredRows(state.date, state.team);

      // For conditional pill: compare agent value vs median of selected metric (in current view)
      const metric = state.metric;
      const vals = rows.map(r => metric === "talkTimeSec" ? timeToSeconds(r.talkTime) : (r[metric] ?? 0))
                       .sort((a,b)=>a-b);
      const median = vals.length ? vals[Math.floor(vals.length/2)] : 0;

      detailTbody.innerHTML = "";
      for(const r of rows){
        const talkSec = timeToSeconds(r.talkTime);
        const metricVal = metric === "talkTimeSec" ? talkSec : (r[metric] ?? 0);

        let pillCls = "neutral";
        if (metricVal > median) pillCls = "good";
        else if (metricVal < median) pillCls = "bad";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.team}</td>
          <td>${r.agent} <span class="pill ${pillCls}" title="Comparado vs mediana de la métrica seleccionada">${pickLabel(metric)}: ${
            metric === "facturado" ? fmtMoney(metricVal) :
            metric === "talkTimeSec" ? secondsToHMS(metricVal) :
            fmtInt(metricVal)
          }</span></td>

          <td class="right mono">${fmtInt(r.dials)}</td>
          <td class="right mono">${fmtInt(r.contacts)}</td>
          <td class="right mono">${fmtInt(r.successFive9)}</td>
          <td class="right mono">${r.talkTime}</td>
          <td class="right mono">${fmtInt(r.leadInbound)}</td>
          <td class="right mono">${fmtInt(r.productPresentation)}</td>
          <td class="right mono">${fmtInt(r.cotizacion)}</td>
          <td class="right mono">${fmtInt(r.successHubspot)}</td>
          <td class="right mono">${fmtInt(r.clienteOutbound)}</td>
          <td class="right mono">${fmtInt(r.referido)}</td>
          <td class="right mono">${fmtInt(r.inboundMesesAnteriores)}</td>
          <td class="right mono">${fmtInt(r.nuevosLeadMM)}</td>
          <td class="right mono">${fmtInt(r.totalClientes)}</td>
          <td class="right mono">${fmtInt(r.campanas)}</td>
          <td class="right mono">${fmtMoney(r.facturado)}</td>
        `;
        detailTbody.appendChild(tr);
      }
    }

    // -----------------------------
    // 9) RENDER ALL
    // -----------------------------
    function renderAll(){
      renderKPIs();
      buildTotalsChart();
      buildRankChart();
      renderTable();
      lastUpdated.textContent = `Render: ${new Date().toLocaleString("es-ES")}`;
    }

    // -----------------------------
    // 10) EVENTS
    // -----------------------------
    dateSel.addEventListener("change", (e)=>{
      state.date = e.target.value;
      renderAll();
    });
    teamSel.addEventListener("change", (e)=>{
      state.team = e.target.value;
      renderAll();
    });
    metricSel.addEventListener("change", (e)=>{
      state.metric = e.target.value;
      renderAll();
    });
    resetBtn.addEventListener("click", ()=>{
      state.date = "2026-01-19";
      state.team = "__ALL__";
      state.metric = "facturado";
      dateSel.value = state.date;
      teamSel.value = state.team;
      metricSel.value = state.metric;
      renderAll();
    });

    // -----------------------------
    // 11) BOOT
    // -----------------------------
    initTeams();
    // defaults
    metricSel.value = state.metric;
    renderAll();
  </script>
</body>
</html>

    

  
  
    

     
